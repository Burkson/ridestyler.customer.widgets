function RideStylerVehicleSelectionModal(e){function t(e){e=e||{};for(var t=1;t<arguments.length;t++)if(arguments[t])for(var n in arguments[t])arguments[t].hasOwnProperty(n)&&(e[n]=arguments[t][n]);return e}function n(e,t){if(e){"string"==typeof e?e=document.querySelectorAll(e):e.tagName&&(e=[e]);for(var n=0;n<e.length;n++)""==e[n].className.trim()?e[n].className=t:(" "+e[n].className+" ").indexOf(" "+t+" ")<0&&(e[n].className+=" "+t)}}function o(e,t){if(e){"string"==typeof e?e=document.querySelectorAll(e):e.tagName&&(e=[e]);for(var n=new RegExp(" "+t+" ","g"),o=new RegExp("(^)"+t+"($| )","g"),i=new RegExp("(^| )"+t+"($)","g"),a=0;a<e.length;a++)e[a].className=e[a].className.replace(n," "),e[a].className=e[a].className.replace(o,""),e[a].className=e[a].className.replace(i,""),""==e[a].className.trim()&&e[a].removeAttribute("class")}}function i(e,t){for(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t.item(n)!==this;);return n>-1});e&&e!==document;e=e.parentNode)if(e.matches(t))return e;return null}function a(){if(!document.getElementById("vsm-backdrop")){var e=document.createElement("div");e.id="vsm-backdrop",e.style.opacity=0,e.style.transition="opacity linear .3s",document.body.appendChild(e),l()}}function l(){var e=document.getElementById("vsm-backdrop");e||a(),setTimeout(function(){e.style.opacity=.55,e.onTransitionEndOnce(function(){})},0)}function r(){var e=document.getElementById("vsm-backdrop");e&&(e.style.opacity=0,e.onTransitionEndOnce(function(){e.parentNode.removeChild(e)}))}function s(){var t=document.querySelectorAll(".vsm-modal:not(#vsm_modal_base)"),n=document.querySelectorAll(".vsm-modal.in")[0],o=f.slice(0),i=h.slice(0);f=[],h=[],b=!0,y.indexOf(n.getAttribute("id"))>-1?(n.style.opacity=0,n.onTransitionEndOnce(function(){[].forEach.call(t,function(e){var t=e.getAttribute("id");y.indexOf(t)>-1&&e.parentNode.removeChild(e)});for(var n={},a=0;a<o.length;a++){var l=o[a].split(":");2==l.length&&(n[l[0]]=l[1])}if(e.callback&&"function"==typeof e.callback){var r={FinalSelectionMade:!1,Vehicle:n,FullSelectionData:i};e.callback(r)}else console.warn("No callback function provided.")}),r()):console.warn("This vsm instance is not shown yet.")}function c(){if(!document.getElementById("vsm_modal_base")){var e=document.createElement("div");e.innerHTML=vsm_template,document.body.appendChild(e.firstChild)}}function d(n,o,i){var a=document.getElementById("vsm_modal_base");if(a){var l=a.cloneNode(!0);if(l.id="vsm_modal_"+_vsmModalIDCounter,y.push("vsm_modal_"+_vsmModalIDCounter),l.className+=" vsm_modal_"+_vsmModalIDCounter,document.body.appendChild(l),void 0!==i){o=t({backModal:i,thisModal:l},o);var r=l.querySelectorAll(".vsm-back-step");[].forEach.call(r,function(t){var n=function(t){t.target.removeEventListener(t.type,n);var i=o.backModal,a=o.thisModal;u(i,a,!0).then(function(){if(f.length&&f.pop(),h.length&&h.pop(),a.parentNode&&a.parentNode.removeChild(a),e.afterBackClicked&&"function"==typeof e.afterBackClicked){for(var t={},n=0;n<f.length;n++){var o=f[n].split(":");2==o.length&&(t[o[0]]=o[1])}var i={FullSelection:t,FullSelectionData:h};e.afterBackClicked(i)}})};t.addEventListener("click",n,!1)})}"function"==typeof n&&n(l,o);var c=l.querySelectorAll(".vsm-close");return[].forEach.call(c,function(e){e.onclick=function(){s()}}),_vsmModalIDCounter++,l}}function u(e,t,i){if(i=!!i,e&&t){var a,l;if(!i){var r=parseInt(t.style.zIndex,10)||0,s=parseInt(e.style.zIndex,10)||0;s<=r&&(s=r+1),e.style.zIndex=s}return g?i?(e.style.display="block",n(e,"in"),l=new Promise(function(e,t){e()}),a=new Promise(function(e,n){setTimeout(function(){o(t,"in"),t.onTransitionEndOnce(function(){t.style.display="none",e()})},50)})):(e.style.display="block",l=new Promise(function(i,l){setTimeout(function(){n(e,"in"),e.onTransitionEndOnce(function(){t.style.display="none",o(t,"in"),i(),a=new Promise(function(e,t){e()})})},50)})):i?(e.style.display="block",n(e,"in"),l=new Promise(function(e,t){e()}),o(t,"in"),t.style.display="none",a=new Promise(function(e,t){e()})):(e.style.display="block",l=new Promise(function(e,t){e()}),n(e,"in"),t.style.display="none",o(t,"in"),a=new Promise(function(e,t){e()})),Promise.all([a,l]).then(function(e){}).catch(function(e){console.warn(e)})}}function m(e){var t={Selection:h};ridestyler.ajax.send({action:"Vehicle/Select",data:t,callback:function(t){t.Success&&(t.BestConfiguration?p(e,t.BestConfiguration):v(e,t.Menu))}})}function v(t,o){var i=t.querySelectorAll(".vsm-list-container")[0],a=t.querySelectorAll(".vsm-header")[0],l=t.querySelectorAll(".vsm-modal-body")[0],r=t.querySelectorAll(".vsm-line-step")[0],s=t.querySelectorAll(".vsm-final")[0],c=o.Options,v=o.Key,p=o.Title,y=o.Groups,g=function(n){var o=n.getAttribute("data-optionvalue"),i=n.getAttribute("data-optionkey"),a=n.getAttribute("data-optionlabel"),l=n.getAttribute("data-menutitle");if(h.push(i+":"+o),f.push(l+":"+a),e.afterOptionSelected&&"function"==typeof e.afterOptionSelected){for(var r={},s=0;s<f.length;s++){var c=f[s].split(":");2==c.length&&(r[c[0]]=c[1])}var v={CurrentSelection:{},FullSelection:r,FullSelectionData:h};v.CurrentSelection[l]=a,e.afterOptionSelected(v)}b||u(d(m,{},t),t)},A=function(e){var t=e.Label,n=e.Value;if(void 0!==t&&void 0!==n){var o=document.createElement("a"),i=document.createTextNode(t);return o.className="vsm-option-item vsm-btn vsm-btn-gray",o.href="javascript:void(0)",o.setAttribute("data-optionvalue",n),o.setAttribute("data-optionlabel",t),o.appendChild(i),o.onclick=function(){g(this)},o}},_=function(e){var t=document.createElement("p"),n=document.createTextNode(e);return t.className="vsm-group-title",t.appendChild(n),t};s.parentNode.removeChild(s),n(r,"vsm-single-step");var E=document.createElement("div"),C=document.createElement("i"),S=document.createElement("span");if(E.className="vsm-column-2",C.className="dot-style dot-before active",S.className="dot-info dot-info-before active",S.innerHTML=p,E.appendChild(C),E.appendChild(S),h.length){n(l,"vsm-has-back");var k=document.createElement("div"),w=document.createElement("span"),N=document.createElement("span");k.className="vsm-column-2 no-style vsm-table",w.className="vsm-table-cell",N.className="vsm-selected-info",w.appendChild(N),k.appendChild(w);var T=f.map(function(e){return e&&2===e.split(":").length?e.split(":")[1]:""});N.innerHTML=T.join(" "),r.appendChild(k),r.appendChild(E)}else(k=document.createElement("div")).className="vsm-column-2 no-style",r.appendChild(k),r.appendChild(E);for(a.innerHTML=o.Description;i.firstChild;)i.removeChild(i.firstChild);if(c.length){var M=document.createElement("div");if(M.className="vsm-group-wrap center-piece",i.appendChild(M),e.GroupOptions&&y){for(var O={},x=0;x<c.length;x++){var I=c[x],F=I.Group;F?O[F]?O[F].push(I):O[F]=[I]:O._ungrouped?O._ungrouped.push(I):O._ungrouped=[I]}for(var q=0;q<y.length;q++){var Z=y[q];if(L=O[Z]){(P=document.createElement("div")).className="vsm-group-list vsm-one-container",P.appendChild(_(Z)),M.appendChild(P);for(x=0;x<L.length;x++)void 0!==(V=A(L[x]))&&(V.setAttribute("data-optionkey",v),V.setAttribute("data-menutitle",p),P.appendChild(V))}}if(O._ungrouped){(P=document.createElement("div")).className="vsm-group-list vsm-one-container",P.appendChild(_("Ungrouped")),M.appendChild(P);for(var L=O._ungrouped,x=0;x<L.length;x++)void 0!==(V=A(L[x]))&&(V.setAttribute("data-optionkey",v),V.setAttribute("data-menutitle",p),P.appendChild(V))}}else{var P=document.createElement("div");P.className="vsm-group-list vsm-one-container",M.appendChild(P);for(x=0;x<c.length;x++){var V=A(c[x]);void 0!==V&&(V.setAttribute("data-optionkey",v),V.setAttribute("data-menutitle",p),P.appendChild(V))}}}}function p(o,a){var l=o.querySelectorAll(".vsm-vehicle-display")[0],c=o.querySelectorAll(".vsm-final .vsm-loaderIcon")[0],d=o.querySelectorAll(".vehicle-result-name")[0],u=(o.querySelectorAll(".vehicle-result-size")[0],o.querySelectorAll(".vsm-find")[0]),m=o.querySelectorAll(".vsm-modal-body")[0],v=o.querySelectorAll(".vsm-in-progress")[0];n(m,"vsm-has-back"),u.innerHTML=e.ConfirmButtonText;for(var p=[],y={},b=0;b<f.length;b++){var g=f[b].split(":");2==g.length&&(p.push(g[1]),y[g[0]]=g[1])}for(var A=p[0],_=p.pop(),b=1;b<p.length&&!(b>=3);b++)A+=" "+p[b];var E=A+" "+_;d.innerHTML=E,n(o.querySelectorAll(".vsm-modal-body")[0],"vsm-final-screen"),v.parentNode.removeChild(v);var C={Width:260,Height:120,PositionX:1,PositionY:1};e.ImageSettings&&t(C,e.ImageSettings),C.VehicleConfiguration=a.Value;var S=ridestyler.ajax.url("Vehicle/Render",C);l.src=S,l.style.display="inline-block",l.onload=function(){c.style.display="none"};var k=function(n){n.target.removeEventListener(n.type,k);var o=document.querySelectorAll(".vsm-modal:not(#vsm_modal_base)"),l=i(this,".vsm-modal"),c=h.slice(0);f=[],h=[],l.style.opacity=0,l.onTransitionEndOnce(function(){[].forEach.call(o,function(e){e.parentNode.removeChild(e)});var n={ImageUrl:S,VehicleDescription:E,VehicleConfiguration:a.Value};if(t(n,y),e.callback&&"function"==typeof e.callback){var i={FinalSelectionMade:!0,Vehicle:n,FullSelectionData:c};e.callback(i)}else s(),console.warn("No callback function provided.")}),r()};u.addEventListener("click",k,!1)}var f=[],h=[],y=[],b=!1;e=t({ConfirmButtonText:"Confirm Vehicle",GroupOptions:!1,afterBackClicked:null,afterOptionSelected:null,callback:null},e);var g=function(){var e=(document.body||document.documentElement).style;return void 0!==e.WebkitTransition||void 0!==e.MozTransition||void 0!==e.OTransition||void 0!==e.transition}();!function(){var e,t=document.createElement("div"),n={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},o="";for(e in n)if(n.hasOwnProperty(e)&&void 0!==t.style[e]){o=n[e];break}HTMLElement.prototype.onTransitionEndOnce=function(e){if(""===o)return e(),this;var t=function(n){e(),n.target.removeEventListener(n.type,t)};return this.addEventListener(o,t,!1),this}}(),this.Show=function(){if(c(),document.querySelectorAll(".vsm-modal:not(#vsm_modal_base)").length)console.warn("There is currently another vsm instance running.");else{var e=d();a(),e.style.display="block",b=!1,setTimeout(function(){n(e,"in"),e.onTransitionEndOnce(function(){m(e)})},50)}},this.Hide=s}var vsm_template='<div id="vsm_modal_base" class="vsm-modal vsm-hide vsm-fade" style="z-index: 9999;" tabindex="-1" role="dialog"> <div class="vsm-modal-container"> <div class="vsm-modal-header"> <button type="button" class="vsm-close"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAARVBMVEUAAACdnZ2ampqbm5ubm5uampqdnZ2ZmZmZmZmZmZmcnJyZmZmZmZmdnZ2ZmZmZmZmbm5uZmZmbm5ubm5uZmZmcnJybm5v/bA1VAAAAF3RSTlMAFL8yOr0Qz//tMvHLEs3zNO8wNuswLru4YpkAAADeSURBVHgBvdUFisQAEETRjrvL/W+6Em8+1PoWNpO8H5y2/1oQRhrESep8lhel9FVeN87nvqDP87ZxXhVxt4GsuT0K+K0Itv9hnrOA3xZuD/rBFcIXkZku6HVBrwt6XdDrgl4V8KOZLui5yRf0unj4md5YPPxiHAt6XdDrQntRzCsFC3i9sriDLv6a1wW9Luh1QS8L+mGWBf20yoLeTBf0sqDftogCnoX0opDebCxcIT2KKhZeFtHD94axCKV3H0zcyYJHUad2FvAocEbhUWTuUMOj2PxdhN6zCAP7p70CQy4hRTemab0AAAAASUVORK5CYII=" style="width:24px;"></button> </div><div class="vsm-modal-body vsm-option-body vsm-list-body"> <a href="javascript:void(0);" class="vsm-back-link vsm-back-step">‚ùÆ </a> <div class="vsm-in-progress"> <p class="vsm-header vsm-center"></p><div class="vsm-line-step center-piece vsm-columns"> </div><div class="vsm-list-container scrollable"><i class="vsm-loaderIcon" alt="Loading options"></i></div></div><div class="vsm-final"> <div class="center-piece vsm-line-step vehicle-result-wrap"> <i class="dot-style dot-before active"></i> <p class="vehicle-result-name"></p><p class="vehicle-result-size"></p></div><div class="scrollable"> <div class="center-piece vehicle-image-wrap"> <div style="position: relative; text-align: center; min-height: 120px;"> <i class="vsm-loaderIcon" alt="Loading an image of your vehicle"></i> <img src="" alt="" class="vsm-vehicle-display" style="display: none;"> </div><a href="javascript:void(0);" class="vsm-btn vsm-btn-gray vsm-full-width vsm-find"></a> </div></div></div></div></div></div>';!function(e){function t(){}function n(e,t){return function(){e.apply(t,arguments)}}function o(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(e,this)}function i(e,t){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(t):(e._handled=!0,void o._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null!==n){var o;try{o=n(e._value)}catch(e){return void l(t.promise,e)}a(t.promise,o)}else(1===e._state?a:l)(t.promise,e._value)}))}function a(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var i=t.then;if(t instanceof o)return e._state=3,e._value=t,void r(e);if("function"==typeof i)return void c(n(i,t),e)}e._state=1,e._value=t,r(e)}catch(t){l(e,t)}}function l(e,t){e._state=2,e._value=t,r(e)}function r(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)i(e,e._deferreds[t]);e._deferreds=null}function s(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function c(e,t){var n=!1;try{e(function(e){n||(n=!0,a(t,e))},function(e){n||(n=!0,l(t,e))})}catch(e){if(n)return;n=!0,l(t,e)}}var d=setTimeout;o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(e,n){var o=new this.constructor(t);return i(this,new s(e,n,o)),o},o.all=function(e){var t=Array.prototype.slice.call(e);return new o(function(e,n){function o(a,l){try{if(l&&("object"==typeof l||"function"==typeof l)){var r=l.then;if("function"==typeof r)return void r.call(l,function(e){o(a,e)},n)}t[a]=l,0==--i&&e(t)}catch(e){n(e)}}if(0===t.length)return e([]);for(var i=t.length,a=0;a<t.length;a++)o(a,t[a])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(t){t(e)})},o.reject=function(e){return new o(function(t,n){n(e)})},o.race=function(e){return new o(function(t,n){for(var o=0,i=e.length;o<i;o++)e[o].then(t,n)})},o._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){d(e,0)},o._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},o._setImmediateFn=function(e){o._immediateFn=e},o._setUnhandledRejectionFn=function(e){o._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=o:e.Promise||(e.Promise=o)}(this);var _vsmModalIDCounter=0;